from __future__ import print_function

import os.path

from google.auth.transport.requests import Request
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from googleapiclient.discovery import build
from googleapiclient.errors import HttpError
from google.oauth2 import service_account
from google.oauth2.service_account import Credentials

import time
from datetime import datetime, timezone, timedelta

from imap_tools import MailBox, AND, MailMessageFlags
import smtplib, ssl
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

from bs4 import BeautifulSoup
import re

import pymongo

import json

def auth():
    """
    Authorizes the session
    :return:
    """
    SCOPES = ['https://www.googleapis.com/auth/spreadsheets', 'https://www.googleapis.com/auth/calendar']
    secret_file = os.path.join(os.getcwd(), 'credentials.json')
    creds = service_account.Credentials.from_service_account_file(secret_file, scopes=SCOPES)
    print("Google API authorized")
    return creds


def get_values(spreadsheet_id, range_name, creds):
    """
    Returns specified spredsheet from Google
    :param spreadsheet_id: Spreadsheet ID
    :param range_name: range of table or name of list
    :param creds: credentials for Google API
    :return:
    """

    service = build('sheets', 'v4', credentials=creds)

    result = service.spreadsheets().values().get(spreadsheetId=spreadsheet_id, range=range_name).execute()
    return result["values"]

def create_event(row, creds):
    """
    Creates an event in Google Calendar
    :param row: Row with new informations about the event
    :param creds: credentials for Google API
    """
    service = build('calendar', 'v3', credentials=creds)
    calendar_list = service.calendarList().list().execute()
    start_date = datetime.strptime(row[3], '%Y-%m-%d %H:%M').isoformat()
    end_date = datetime.strptime(row[4], '%Y-%m-%d %H:%M').isoformat()
    if len(row) == 5:
        event = {
            'summary': f'Rezervace pro {row[1]} - nepotvrzeno',
            'location': 'Tvarožná 206, 664 05 Tvarožná',
            'description': f'{row[1]} si vytvořil rezervaci pro Komunitní centrum\n\nE-mail: {row[2]}\n\nPoznámka: ',
            'colorId':'5',
            'start': {
                'dateTime': f'{start_date}',
                'timeZone': 'Europe/Prague',
            },
            'end': {
                'dateTime': f'{end_date}',
                'timeZone': 'Europe/Prague',
            },
        }
    else:
        event = {
            'summary': f'Rezervace pro {row[1]} - nepotvrzeno',
            'location': 'Tvarožná 206, 664 05 Tvarožná',
            'description': f'{row[1]} si vytvořil rezervaci pro Komunitní centrum\n\nE-mail: {row[2]}\n\nPoznámka: {row[5]}',
            'colorId': '5',
            'start': {
                'dateTime': f'{start_date}',
                'timeZone': 'Europe/Prague',
            },
            'end': {
                'dateTime': f'{end_date}',
                'timeZone': 'Europe/Prague',
            },
        }
    event = service.events().insert(calendarId='c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1@group.calendar.google.com', body=event).execute()
    print(f"Created new event in Google Calendar\n{event.get('htmlLink')}")
    return(event.get('htmlLink'))

def check_availability(row, creds):
    """
    Checks if the specified row is free in Google Calendar
    :param row: row from Google sheets
    :param creds: credentials for Google API
    :return:
    """
    service = build('calendar', 'v3', credentials=creds)
    calendar_list = service.calendarList().list().execute()
    start_date = datetime.strptime(row[3], '%Y-%m-%d %H:%M').astimezone().isoformat()
    end_date = datetime.strptime(row[4], '%Y-%m-%d %H:%M').astimezone().isoformat()

    event = {
  "timeMin": f'{start_date}',
  "timeMax": f'{end_date}',
  "timeZone": 'Europe/Prague',
  "items": [
    {
      "id": 'c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1@group.calendar.google.com'
    }
  ]
}

    busy = service.freebusy().query(body=event).execute()
    if busy["calendars"]["c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1@group.calendar.google.com"]["busy"] == []:
        return None
    else:
        return(busy["calendars"]["c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1@group.calendar.google.com"]["busy"])


def get_emails():
    """
    Gets all unread emails and returns it as rows to Google sheets
    :return:
    """
    rows = []

    with MailBox(os.getenv("IMAP_SERVER")).login(os.getenv("EMAIL_LOGIN"), os.getenv("EMAIL_PASSWORD")) as mailbox:

        uids = []

        for msg in mailbox.fetch(criteria=AND(seen=False, from_="tvarozna@skaut.cz"),mark_seen=False,bulk=True):
            #print(f"{msg.date} {msg.subject} \n\n")

            html = msg.html
            soup = BeautifulSoup(html, 'html.parser')
            html_table = soup.find('td', class_="mcnTextContent")
            soup2 = BeautifulSoup(str(html_table), 'html.parser')
            content = soup2.find_all('td')

            row = []
            row.append(msg.subject)
            row.append((msg.date + timedelta(hours=2)).strftime('%d.%m.%Y %H:%M:%S'))
            for i in range(len(content)):
                if i ==0:
                    continue
                if i%2 == 0:
                    row.append(re.sub('<[^<]+?>', '', str(content[i])))

            rows.append(row)
            uids.append(msg.uid)
        mailbox.flag(uids, MailMessageFlags.SEEN, True)
        return rows

def write_rows(row,spreadsheet_id,list_name, creds):
    """
    Adds one row to specified Google spreadsheet
    :param row: row to add
    :param spreadsheet_id: Google spreadsheet ID
    :param list_name: name of the sheet
    :param creds: credentials for Google API
    """
    service = build('sheets', 'v4', credentials=creds)
    body = {
        'values': [row]
    }
    result = service.spreadsheets().values().append(
        spreadsheetId=spreadsheet_id, range=list_name,
        valueInputOption="USER_ENTERED", body=body).execute()

def send_email(message_html, subject, receiver, sender):
    """
    Sends a html email to specified adress
    :param message_html: body of email in html
    :param subject: subject of the email
    :param receiver: receiver email
    :param sender: Sender email (must be logged in by this adress)
    """
    context = ssl.create_default_context()

    message = MIMEMultipart("alternative")
    message["Subject"] = subject
    message["From"] = sender
    message["To"] = receiver

    message.attach(MIMEText(message_html, "html"))

    with smtplib.SMTP_SSL(os.getenv("SMTP_SERVER"), 465, context=context) as server:
        server.login(os.getenv("EMAIL_LOGIN"), os.getenv("EMAIL_PASSWORD"))
        server.sendmail(sender, receiver, message.as_string())

def main():
    #Login to Mongo DB
    mongo_client = pymongo.MongoClient(f"mongodb+srv://newton:{os.getenv('DATABASE_PASSWORD')}@skautitvarozna.ejedxwg.mongodb.net/?retryWrites=true&w=majority")
    print("Client started succesfully")
    while True:
            #If there is a new email with data, wirte it to google sheets
            rows = get_emails()
            if rows:
                forms = mongo_client['skautitvarozna']['forms']
                for i in rows:
                    data = forms.find_one({'form_id': i[0]})
                    #Sends notification to another email for specific form
                    if i[0] == "1113":
                        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Nová registrace do našeho oddílu. Detaily zde: <a href=https://docs.google.com/spreadsheets/d/1S3FXcenMquxH2vdJwCBQRwcvd2lgm53Q_BRelK-bh3Y/edit#gid=0>https://docs.google.com/spreadsheets/d/1S3FXcenMquxH2vdJwCBQRwcvd2lgm53Q_BRelK-bh3Y/edit#gid=0</a></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Toto je automatizovaná zprává pro správce webu skautitvarozna.cz</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
                        send_email(message_html, "Nová přihláška do Tvaroženského oddílu", os.getenv("NOTIFICATION_EMAIL"), os.getenv("EMAIL_LOGIN"))
                        print(f"Sent admin email to {os.getenv('NOTIFICATION_EMAIL')}")
                    i.pop(0)
                    if data:
                        write_rows(i,data['sheet_id'],data['list_name'],creds)
                        print(f"Parsing follwoing data to Google sheet with id {data['sheet_id']}\nData:{i}")

            #If there is a new row, create an event
            forms = mongo_client['skautitvarozna']['forms']
            data = forms.find_one({'form_id': '1257'})
            table = get_values(data['sheet_id'], data['list_name'], creds)
            if data['table_length'] < len(table):
                for i in range(len(table) - data['table_length'], 0, -1):
                    start_date = datetime.strptime(table[-i][3], '%Y-%m-%d %H:%M')
                    end_date = datetime.strptime(table[-i][4], '%Y-%m-%d %H:%M')
                    row = table[-i]

                    #If the Poznámka cell is not present, add empty string
                    if len(row) == 5:
                        row.append("")

                    #If the date in form is invalid, send an email to customer about failiure
                    if start_date >= end_date:
                        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Dobrý den, vaše rezervace na webu www.skautitvarozna.cz nemohla být vytvořena, protože jste zadali neplatný čas rezervace. Níže si můžete přečíst vaši rezervaci a náhled do aktuálního kalendáře Komunitního centra a zkuste provést rezervaci znovu.</p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-4" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-top:20px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Vaše rezervace:</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-5" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-left:20px;padding-right:20px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="paragraph_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="color:#000;direction:ltr;font-family:themix,serif;font-size:16px;font-weight:400;letter-spacing:0;line-height:120%;text-align:center;mso-line-height-alt:19.2px"> <p style="margin:0;margin-bottom:16px"><strong>Datum vytvoření rezervace</strong></p> <p style="margin:0;margin-bottom:16px">{row[0]}</p> <p style="margin:0;margin-bottom:16px"><strong>Jméno</strong></p> <p style="margin:0;margin-bottom:16px">{row[1]}</p> <p style="margin:0;margin-bottom:16px"><strong>E-mail</strong></p> <p style="margin:0;margin-bottom:16px">{row[2]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum příjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[3]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum odjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[4]}</p> <p style="margin:0;margin-bottom:16px"><strong>Poznámka</strong></p> <p style="margin:0">{row[5]}</p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-7" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Aktuální kalendář Komunitního centra:</span></strong></span><span style="font-size:24px;">&nbsp;</span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-8" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="html_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad"> <div style="font-family:themix,serif;text-align:center" align="center"> <a href="https://calendar.google.com/calendar/embed?src=c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1%40group.calendar.google.com&ctz=Europe%2FPrague">Pro zobrazení kalendáře klikněte sem.</a> </div> </td> </tr> </table> <table class="divider_block block-2" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:20px;padding-left:5px;padding-right:5px;padding-top:20px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Pokud si myslíte, že nastala chyba, kontaktujte nás na e-mail:</span></strong></p> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:16px;"> tvarozna@skaut.cz</span></strong></p> <br> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:12px;"> Toto je automatizovaná zpráva, odpovídejte pouze na výše uvedený e-mail.</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
                        send_email(message_html, "Vaše rezervace na skautitvarozna.cz nebyla provedena", row[2],
                                   os.getenv("EMAIL_LOGIN"))
                        print(f"Sent a failiure email to {row[2]}")

                    #If the date is already occupied in Google calendar, send an email to customer about failiure
                    elif check_availability(table[-i], creds) is not None:
                        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Dobrý den, vaše rezervace na webu www.skautitvarozna.cz nemohla být vytvořena, protože ve váš zadaný čas již existuje jiná rezervace. Níže si můžete přečíst vaši rezervaci a náhled do aktuálního kalendáře Komunitního centra a zkuste provést rezervaci znovu.</p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-4" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-top:20px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Vaše rezervace:</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-5" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-left:20px;padding-right:20px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="paragraph_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="color:#000;direction:ltr;font-family:themix,serif;font-size:16px;font-weight:400;letter-spacing:0;line-height:120%;text-align:center;mso-line-height-alt:19.2px"> <p style="margin:0;margin-bottom:16px"><strong>Datum vytvoření rezervace</strong></p> <p style="margin:0;margin-bottom:16px">{row[0]}</p> <p style="margin:0;margin-bottom:16px"><strong>Jméno</strong></p> <p style="margin:0;margin-bottom:16px">{row[1]}</p> <p style="margin:0;margin-bottom:16px"><strong>E-mail</strong></p> <p style="margin:0;margin-bottom:16px">{row[2]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum příjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[3]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum odjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[4]}</p> <p style="margin:0;margin-bottom:16px"><strong>Poznámka</strong></p> <p style="margin:0">{row[5]}</p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-7" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Aktuální kalendář Komunitního centra:</span></strong></span><span style="font-size:24px;">&nbsp;</span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-8" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="html_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad"> <div style="font-family:themix,serif;text-align:center" align="center"> <a href="https://calendar.google.com/calendar/embed?src=c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1%40group.calendar.google.com&ctz=Europe%2FPrague">Pro zobrazení kalendáře klikněte sem.</a> </div> </td> </tr> </table> <table class="divider_block block-2" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:20px;padding-left:5px;padding-right:5px;padding-top:20px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Pokud si myslíte, že nastala chyba, kontaktujte nás na e-mail:</span></strong></p> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:16px;"> tvarozna@skaut.cz</span></strong></p> <br> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:12px;"> Toto je automatizovaná zpráva, odpovídejte pouze na výše uvedený e-mail.</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
                        send_email(message_html, "Vaše rezervace na skautitvarozna.cz nebyla provedena", row[2], os.getenv("EMAIL_LOGIN"))
                        print(f"Sent a failiure email to {row[2]}")

                    # Creates event in Google calendar and sends an email to admin and customer
                    else:
                        link = create_event(table[-i],creds)

                        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Dobrý den, vaše rezervace na webu www.skautitvarozna.cz byla úspěšně vytvořena, brzy se Vám ozveme ohledně potvrzení této rezervace. Níže si můžete přečíst vaši rezervaci a náhled do aktuálního kalendáře Komunitního centra.</p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-4" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-top:20px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Vaše rezervace:</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-5" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-left:20px;padding-right:20px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="paragraph_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="color:#000;direction:ltr;font-family:themix,serif;font-size:16px;font-weight:400;letter-spacing:0;line-height:120%;text-align:center;mso-line-height-alt:19.2px"> <p style="margin:0;margin-bottom:16px"><strong>Datum vytvoření rezervace</strong></p> <p style="margin:0;margin-bottom:16px">{row[0]}</p> <p style="margin:0;margin-bottom:16px"><strong>Jméno</strong></p> <p style="margin:0;margin-bottom:16px">{row[1]}</p> <p style="margin:0;margin-bottom:16px"><strong>E-mail</strong></p> <p style="margin:0;margin-bottom:16px">{row[2]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum příjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[3]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum odjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[4]}</p> <p style="margin:0;margin-bottom:16px"><strong>Poznámka</strong></p> <p style="margin:0">{row[5]}</p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-7" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Aktuální kalendář Komunitního centra:</span></strong></span><span style="font-size:24px;">&nbsp;</span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-8" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="html_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad"> <div style="font-family:themix,serif;text-align:center" align="center"> <a href="https://calendar.google.com/calendar/embed?src=c_9bfb7b6a9797003121615270b30a9ac20ef455b10d896395915ffa422dad1de1%40group.calendar.google.com&ctz=Europe%2FPrague">Pro zobrazení kalendáře klikněte sem.</a> </div> </td> </tr> </table> <table class="divider_block block-2" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:20px;padding-left:5px;padding-right:5px;padding-top:20px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Pokud si myslíte, že nastala chyba, kontaktujte nás na e-mail:</span></strong></p> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:16px;"> tvarozna@skaut.cz</span></strong></p> <br> <p style="margin:0;text-align:center;mso-line-height-alt:24px"><strong><span style="font-size:12px;"> Toto je automatizovaná zpráva, odpovídejte pouze na výše uvedený e-mail.</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
                        send_email(message_html, "Vaše rezervace na skautitvarozna.cz byla úspěšně provedena", row[2],
                                   os.getenv("EMAIL_LOGIN"))
                        print(f"Sent a success email to {row[2]}")

                        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Na webu www.skautitvarozna.cz byla vytvořena nová rezervace. Pokud chcete rezervaci potvrdit, klikněte <a href={link}>sem</a> a smažte "-nepotvrzeno" ze jména akce. Níže naleznete kompletní registraci a kontakt na osobu, která rezervaci vytvořila.</p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-4" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-top:20px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;text-align:center;mso-line-height-alt:14.399999999999999px;"><span style="font-size:24px;"><strong><span style>Data rezervace:</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-5" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:20px;padding-left:20px;padding-right:20px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="paragraph_block block-1" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="color:#000;direction:ltr;font-family:themix,serif;font-size:16px;font-weight:400;letter-spacing:0;line-height:120%;text-align:center;mso-line-height-alt:19.2px"> <p style="margin:0;margin-bottom:16px"><strong>Datum vytvoření rezervace</strong></p> <p style="margin:0;margin-bottom:16px">{row[0]}</p> <p style="margin:0;margin-bottom:16px"><strong>Jméno</strong></p> <p style="margin:0;margin-bottom:16px">{row[1]}</p> <p style="margin:0;margin-bottom:16px"><strong>E-mail</strong></p> <p style="margin:0;margin-bottom:16px">{row[2]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum příjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[3]}</p> <p style="margin:0;margin-bottom:16px"><strong>Datum odjezdu</strong></p> <p style="margin:0;margin-bottom:16px">{row[4]}</p> <p style="margin:0;margin-bottom:16px"><strong>Poznámka</strong></p> <p style="margin:0">{row[5]}</p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Toto je automatizovaná zprává pro správce webu skautitvarozna.cz</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
                        send_email(message_html, "Nová rezervace pro Komunitní centrum na webu skautitvarozna.cz", os.getenv("NOTIFICATION_EMAIL"),
                                   os.getenv("EMAIL_LOGIN"))
                        print(f"Sent admin email to {os.getenv('NOTIFICATION_EMAIL')}")
                forms.update_one({'form_id': '1257'}, {'$set': {'table_length': len(table)}})

            #Updates length of spreadsheet in databse
            if len(table) == 1 or data['table_length'] > len(table):
                forms.update_one({'form_id': '1257'}, {'$set': {'table_length': len(table)}})
            #Wait 5 seconds for next check
            time.sleep(5)
if __name__ == '__main__':
    try:
        creds = auth()
        main()
    except Exception as e:
        error = str(e)
        error = error.replace("<", "&lt;")
        error = error.replace(">", "&gt;")
        message_html = f"""<!DOCTYPE html><html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <!--[if mso]> <xml> <o:OfficeDocumentSettings> <o:PixelsPerInch>96</o:PixelsPerInch> <o:AllowPNG/> </o:OfficeDocumentSettings> </xml> <![endif]--> <style> *{{ box-sizing:border-box}}@font-face {{ font-family: 'skautbold'; src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff') format('woff'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/skaut-bold-webfont.svg#skautbold') format('svg'); font-weight: normal; font-style: normal;}}@font-face {{ font-family: 'themix'; src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.eot? #iefix') format('embedded-opentype'); src: url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff') format('woff'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.woff2') format('woff2'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.otf') format('opentype'), url('https://cdn.skauting.cz/fonts/TheMix_LT_400.svg#themix') format('svg'); font-weight: 400; font-style: normal;}}body{{ margin:0; padding:0}}a[x-apple-data-detectors]{{ color:inherit!important; text-decoration:inherit!important}}#MessageViewBody a{{ color:inherit; text-decoration:none}}p{{ line-height:inherit}}.desktop_hide,.desktop_hide table{{ mso-hide:all; display:none; max-height:0; overflow:hidden}}.image_block img+div{{ display:none}} @media (max-width:660px){{ .mobile_hide{{ display:none }} .row-content{{ width:100%!important }} .stack .column{{ width:100%; display:block }} .mobile_hide{{ min-height:0; max-height:0; max-width:0; overflow:hidden; font-size:0 }} .desktop_hide,.desktop_hide table{{ display:table!important; max-height:none!important }}}} </style> </head> <body style="background-color:#f28d00;margin:0;padding:0;-webkit-text-size-adjust:none;text-size-adjust:none"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-left:10px;padding-right:10px;padding-top:20px;width:100%"> <div class="alignment" align="center" style="line-height:10px"><img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/0db9f180-d222-4b2b-9371-cf9393bf4764/0bd8b69e-4024-4f26-9010-6e2a146401fb/289696603_2456118851212186_3533214291994924697_n.png" style="display:block;height:auto;border:0;max-width:160px;width:100%" width="160" alt="Alternate text" title="Alternate text"></div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-2" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:20px"> <div style="font-family:skautbold"> <div class style="font-size:12px;font-family:skautbold,serif;mso-line-height-alt:14.399999999999999px;color:#f28d00;line-height:1.2"> <p style="margin:0;font-size:14px;text-align:center;mso-line-height-alt:16.8px"><span style="font-size:34px;"><strong><span style>Skauti Tvarožná</span></strong></span></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-3" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#f28d00"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:10px;padding-top:10px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="text_block block-1" width="100%" border="0" cellpadding="15" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad"> <div style="font-family:themix"> <div class style="font-size:12px;font-family:themix,serif;mso-line-height-alt:21.6px;color:#161616;line-height:1.8"> <p style="margin:0;text-align:center;font-size:20px;mso-line-height-alt:36px">Na backend aplikaci webu www.skautitvarozna.cz vznikla nečekaná chyba. Výpis chyby: {error}<a></a></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="row row-6" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;background-color:#fff;color:#000;width:640px;margin:0 auto" width="640"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace:0;mso-table-rspace:0;font-weight:400;text-align:left;padding-bottom:5px;padding-top:5px;vertical-align:top;border-top:0;border-right:0;border-bottom:0;border-left:0"> <table class="divider_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="pad" style="padding-bottom:10px;padding-left:5px;padding-right:5px;padding-top:10px"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace:0;mso-table-rspace:0"> <tr> <td class="divider_inner" style="font-size:1px;line-height:1px;border-top:4px solid #bbb"><span>&#8202;</span></td> </tr> </table> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="text_block block-3" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace:0;mso-table-rspace:0;word-break:break-word"> <tr> <td class="pad" style="padding-bottom:30px;padding-left:10px;padding-right:10px;padding-top:10px"> <div style="font-family:themix,sans-serif"> <div class style="font-family:themix,sans-serif;font-size:12px;mso-line-height-alt:18px;color:#5c5c5c;line-height:1.5"> <p style="margin:0;text-align:center;mso-line-height-alt:18px"><strong><span style="font-size:16px;">Toto je automatizovaná zprává pro správce webu skautitvarozna.cz</span></strong></p> </div> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!-- End --> </body></html>"""
        send_email(message_html, "Na backend aplikaci webu skautitvarozna.cz vznikla nečekaná chyba", os.getenv("ADMIN_EMAIL"), os.getenv("EMAIL_LOGIN"))
        print(e)
